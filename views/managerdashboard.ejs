<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard</title>
    <link rel="stylesheet" href="/styles/managerdashboard.css">

    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
        }
    </script>

    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</head>
<body>

    <div id="google_translate_element" style="position: absolute; top: 10px; right: 10px;"></div>

    <div id="content">
        <h1>Manager Dashboard</h1>

        <div class="dashboard-actions">
            <button id="ordersBtn" onclick="viewPreviousOrders()">Previous Orders</button>
            <button id="inventoryBtn" onclick="goToInventory()">Inventory</button>
            <button id="staffBtn" onclick="goToStaff()">Staff</button>
            <button id="addDrinkBtn" onclick="openAddDrinkModal()">Add Drink</button>
            <button id="logoutBtn" onclick="goToMain()">Logout</button>
        </div>

        <div class="report-section">
            <h2>Reports</h2>
            <button id="reportsBtn">X/Z Reports</button>

            <label for="startDateInput">Start Date & Time:</label>
            <input type="datetime-local" id="startDateInput" name="startDateInput">

            <label for="endDateInput">End Date & Time:</label>
            <input type="datetime-local" id="endDateInput" name="endDateInput">

            <button id="productUsageReportBtn" onclick="generateProductUsageReport()">Generate Product Usage Report</button>
        </div>

        <!-- Add Drink Modal -->
        <div id="addDrinkModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Add New Drink</h2>
                <form id="addDrinkForm">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required><br><br>

                    <label for="category">Category:</label>
                    <select id="category" name="category" required>
                        <!-- Categories will be populated here -->
                    </select><br><br>

                    <label for="price">Price:</label>
                    <input type="number" id="price" name="price" step="0.01" required><br><br>

                    <label for="ingredients">Ingredients (comma-separated):</label>
                    <input type="text" id="ingredients" name="ingredients" required><br><br>

                    <button type="submit">Add Drink</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Get the modal
        var modal = document.getElementById("addDrinkModal");

        // Get the button that opens the modal
        var btn = document.getElementById("addDrinkBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        function openAddDrinkModal() {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Fetch categories and populate the dropdown
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/staff/categories') // New route to fetch categories
                .then(response => response.json())
                .then(categories => {
                    const categorySelect = document.getElementById('category');
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        categorySelect.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching categories:', error));

            const addDrinkForm = document.getElementById('addDrinkForm');

            if (addDrinkForm) {
                addDrinkForm.addEventListener('submit', async function(event) {
                    event.preventDefault(); // Prevent the default form submission

                    const name = document.getElementById('name').value;
                    const category = document.getElementById('category').value;
                    const price = document.getElementById('price').value;
                    const ingredients = document.getElementById('ingredients').value;

                    // Send data to the server
                    try {
                        const response = await fetch('/staff/add-drink', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({ name, category, price, ingredients }),
                        });

                        const data = await response.json();

                        if (response.ok) {
                            alert(data.message); // Show success message
                            document.getElementById("addDrinkModal").style.display = "none"; // Close modal
                        } else {
                            alert(data.message); // Show error message
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        alert('An error occurred while adding the drink.');
                    }
                });
            }
        });
    </script>
    <script src="/scripts/speaktext.js"></script>
</body>
</html>
